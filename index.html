<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRTF Scheduler</title>
    <link href="./style.css" rel="stylesheet">
    
</head>
<body>
    <div class="container">
        <div class="header-gradient shadow-md">
            <h1 class="text-3xl font-bold text-center">Shortest Remaining Time Next (SRTN) Scheduler</h1>
            <p class="text-center mt-2 opacity-90">CPU Scheduling Algorithm Visualization</p>
        </div>
        
        <!-- Number of processes input -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Enter Number of Processes</h2>
            <div class="flex items-center space-x-4">
                <input type="number" id="process-count" min="1" max="10" value="5" class="input-field">
                <button id="generate-table" class="button button-primary">Generate Table</button>
            </div>
            
            <!-- Control buttons -->
            <div class="control-buttons">
                <button id="reset-btn" class="button button-danger">Reset All</button>
            </div>
        </div>
        
        <!-- Process details table -->
        <div id="process-table-container" class="card">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Process Details</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr class="bg-indigo-50">
                            <th class="border-b p-3 text-indigo-800">Process ID</th>
                            <th class="border-b p-3 text-indigo-800">CPU Burst Time (msec)</th>
                            <th class="border-b p-3 text-indigo-800">Arrival Time (msec)</th>
                        </tr>
                    </thead>
                    <tbody id="process-input-container">
                        <!-- Process rows will be generated here -->
                    </tbody>
                </table>
            </div>
            <div class="mt-5 flex justify-end">
                <button id="calculate-button" class="button button-success pulse-animation">Calculate</button>
            </div>
        </div>
        
        <!-- Action buttons - Fixed to be visible -->
        <div id="action-buttons" class="card hidden">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Metrics & Results</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <button id="gantt-chart-btn" class="action-btn purple">GANTT Chart</button>
                <button id="waiting-time-btn" class="action-btn blue">Process Waiting Time</button>
                <button id="avg-waiting-time-btn" class="action-btn blue">Average Waiting Time</button>
                <button id="completion-time-btn" class="action-btn green">Process Completion Time</button>
                <button id="avg-completion-time-btn" class="action-btn green">Average Completion Time</button>
                <button id="turnaround-time-btn" class="action-btn yellow">Process Turn Around Time</button>
                <button id="avg-turnaround-time-btn" class="action-btn yellow">Average Turn Around Time</button>
            </div>
        </div>
        
        <!-- Results display area -->
        <div id="results-container" class="card hidden">
            <h2 id="result-title" class="text-xl font-semibold mb-4 text-gray-800 pb-2 border-b border-gray-200">Results</h2>
            <div id="result-content" class="overflow-x-auto">
                <!-- Results will be shown here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const processCountInput = document.getElementById('process-count');
            const generateTableBtn = document.getElementById('generate-table');
            const processInputContainer = document.getElementById('process-input-container');
            const calculateButton = document.getElementById('calculate-button');
            const actionButtons = document.getElementById('action-buttons');
            const resultsContainer = document.getElementById('results-container');
            const resultTitle = document.getElementById('result-title');
            const resultContent = document.getElementById('result-content');
            
            // New buttons
            const resetBtn = document.getElementById('reset-btn');
            
            // Button elements
            const ganttChartBtn = document.getElementById('gantt-chart-btn');
            const waitingTimeBtn = document.getElementById('waiting-time-btn');
            const avgWaitingTimeBtn = document.getElementById('avg-waiting-time-btn');
            const completionTimeBtn = document.getElementById('completion-time-btn');
            const avgCompletionTimeBtn = document.getElementById('avg-completion-time-btn');
            const turnaroundTimeBtn = document.getElementById('turnaround-time-btn');
            const avgTurnaroundTimeBtn = document.getElementById('avg-turnaround-time-btn');
            
            // Global variables
            let processData = [];
            let ganttChartData = [];
            let firstResponseTime = {}; // Store first response time for each process
            
            // Hide the action buttons on initial load
            actionButtons.classList.add('hidden');
            
            // Generate table based on number of processes
            generateTableBtn.addEventListener('click', function() {
                const count = parseInt(processCountInput.value);
                if (count < 1 || count > 10) {
                    showNotification('Please enter a number between 1 and 10', 'error');
                    return;
                }
                
                generateProcessTable(count);
                showNotification('Process table generated successfully!', 'success');
            });
            
            // Calculate button event
            calculateButton.addEventListener('click', function() {
                if (validateInputs()) {
                    processData = collectProcessData();
                    runSRTFAlgorithm();
                    actionButtons.classList.remove('hidden');
                    resultsContainer.classList.add('hidden');

                    // Smooth scroll to Metrics & Results section
                    actionButtons.scrollIntoView({ behavior: 'smooth' });
                    
                    // Add animation to metrics buttons
                    animateMetricsButtons();
                    
                    showNotification('Calculation completed!', 'success');
                }
            });
            
            // Reset button event
            resetBtn.addEventListener('click', function() {
                // Reset process count
                processCountInput.value = 5;
                
                // Clear process table
                generateProcessTable(5);
                
                // Clear results and hide sections
                processData = [];
                ganttChartData = [];
                firstResponseTime = {};
                actionButtons.classList.add('hidden');
                resultsContainer.classList.add('hidden');
                
                showNotification('All data has been reset', 'info');
            });
            
            // Action button events
            ganttChartBtn.addEventListener('click', showGanttChart);
            waitingTimeBtn.addEventListener('click', showWaitingTime);
            avgWaitingTimeBtn.addEventListener('click', showAvgWaitingTime);
            completionTimeBtn.addEventListener('click', showCompletionTime);
            avgCompletionTimeBtn.addEventListener('click', showAvgCompletionTime);
            turnaroundTimeBtn.addEventListener('click', showTurnaroundTime);
            avgTurnaroundTimeBtn.addEventListener('click', showAvgTurnaroundTime);
            
            // Generate process input table
            function generateProcessTable(count) {
                processInputContainer.innerHTML = '';
                
                for (let i = 0; i < count; i++) {
                    const row = document.createElement('tr');
                    row.className = 'table-row-alt hover:bg-gray-50 transition-colors';
                    
                    // Process ID cell
                    const pidCell = document.createElement('td');
                    pidCell.className = 'border-b p-3';
                    pidCell.textContent = `P${i+1}`;
                    
                    // CPU Burst Time cell
                    const burstCell = document.createElement('td');
                    burstCell.className = 'border-b p-3';
                    const burstInput = document.createElement('input');
                    burstInput.type = 'number';
                    burstInput.min = '0.1';
                    burstInput.step = '0.1';
                    burstInput.className = 'input-field w-full p-2 border rounded burst-time';
                    burstInput.setAttribute('data-pid', `P${i+1}`);
                    burstInput.setAttribute('placeholder', 'msec');
                    burstCell.appendChild(burstInput);
                    
                    // Arrival Time cell
                    const arrivalCell = document.createElement('td');
                    arrivalCell.className = 'border-b p-3';
                    const arrivalInput = document.createElement('input');
                    arrivalInput.type = 'number';
                    arrivalInput.min = '0';
                    arrivalInput.step = '0.1';
                    arrivalInput.className = 'input-field w-full p-2 border rounded arrival-time';
                    arrivalInput.setAttribute('data-pid', `P${i+1}`);
                    arrivalInput.setAttribute('placeholder', 'msec');
                    arrivalCell.appendChild(arrivalInput);
                    
                    row.appendChild(pidCell);
                    row.appendChild(burstCell);
                    row.appendChild(arrivalCell);
                    
                    // Add with fade-in animation
                    row.style.opacity = '0';
                    processInputContainer.appendChild(row);
                    
                    // Trigger animation
                    setTimeout(() => {
                        row.style.transition = 'opacity 0.3s ease';
                        row.style.opacity = '1';
                    }, i * 50);
                }
            }
            
            // Validate that all inputs are filled
            function validateInputs() {
                const burstInputs = document.querySelectorAll('.burst-time');
                const arrivalInputs = document.querySelectorAll('.arrival-time');
                
                for (let input of burstInputs) {
                    if (!input.value || parseFloat(input.value) <= 0) {
                        showNotification('Please fill all CPU burst times with positive values', 'error');
                        input.classList.add('error-input');
                        setTimeout(() => input.classList.remove('error-input'), 2000);
                        return false;
                    }
                }
                
                for (let input of arrivalInputs) {
                    if (!input.value || parseFloat(input.value) < 0) {
                        showNotification('Please fill all arrival times with non-negative values', 'error');
                        input.classList.add('error-input');
                        setTimeout(() => input.classList.remove('error-input'), 2000);
                        return false;
                    }
                }
                
                return true;
            }
            
            // Collect process data from form
            function collectProcessData() {
                const data = [];
                const rows = processInputContainer.querySelectorAll('tr');
                
                rows.forEach((row, index) => {
                    const pid = `P${index+1}`;
                    const burstTime = parseFloat(row.querySelector('.burst-time').value);
                    const arrivalTime = parseFloat(row.querySelector('.arrival-time').value);
                    
                    data.push({
                        pid: pid,
                        burstTime: burstTime,
                        arrivalTime: arrivalTime,
                        remainingTime: burstTime,
                        completionTime: 0,
                        turnaroundTime: 0,
                        waitingTime: 0,
                        responseTime: -1 // -1 indicates not started yet
                    });
                });
                
                return data;
            }
            
            // Run SRTF algorithm
            function runSRTFAlgorithm() {
                const processes = JSON.parse(JSON.stringify(processData)); // Deep copy
                let currentTime = 0;
                let completedProcesses = 0;
                ganttChartData = [];
                firstResponseTime = {}; // Reset response time tracking
                let prevProcess = null;
                
                // Sort processes by arrival time initially
                processes.sort((a, b) => a.arrivalTime - b.arrivalTime);
                
                // Find the time of the earliest arrival
                if (processes.length > 0) {
                    currentTime = processes[0].arrivalTime;
                }
                
                // Time quantum for simulation (smaller for more precision with decimals)
                const timeQuantum = 0.1;
                
                // Continue until all processes are completed
                while (completedProcesses < processes.length) {
                    // Find the process with shortest remaining time among arrived processes
                    let shortestIndex = -1;
                    let shortestTime = Number.MAX_VALUE;
                    
                    for (let i = 0; i < processes.length; i++) {
                        if (processes[i].arrivalTime <= currentTime && processes[i].remainingTime > 0) {
                            if (processes[i].remainingTime < shortestTime) {
                                shortestTime = processes[i].remainingTime;
                                shortestIndex = i;
                            }
                        }
                    }
                    
                    // If no process is found, increment time
                    if (shortestIndex === -1) {
                        currentTime += timeQuantum;
                        continue;
                    }
                    
                    // Add to Gantt chart if process changes
                    if (prevProcess !== processes[shortestIndex].pid) {
                        if (ganttChartData.length > 0) {
                            ganttChartData[ganttChartData.length - 1].endTime = currentTime;
                        }
                        
                        ganttChartData.push({
                            pid: processes[shortestIndex].pid,
                            startTime: currentTime,
                            endTime: -1 // Will be updated later
                        });
                        
                        prevProcess = processes[shortestIndex].pid;
                    }
                    
                    // Record first response time if not already recorded
                    if (processes[shortestIndex].responseTime === -1) {
                        processes[shortestIndex].responseTime = currentTime - processes[shortestIndex].arrivalTime;
                        firstResponseTime[processes[shortestIndex].pid] = processes[shortestIndex].responseTime;
                    }
                    
                    // Decrement remaining time of selected process
                    const timeToReduce = Math.min(timeQuantum, processes[shortestIndex].remainingTime);
                    processes[shortestIndex].remainingTime -= timeToReduce;
                    currentTime += timeToReduce;
                    
                    // Fix floating point precision issues
                    processes[shortestIndex].remainingTime = parseFloat(processes[shortestIndex].remainingTime.toFixed(1));
                    currentTime = parseFloat(currentTime.toFixed(1));
                    
                    // If process completes
                    if (processes[shortestIndex].remainingTime <= 0) {
                        completedProcesses++;
                        processes[shortestIndex].completionTime = currentTime;
                        processes[shortestIndex].turnaroundTime = 
                            processes[shortestIndex].completionTime - processes[shortestIndex].arrivalTime;
                        processes[shortestIndex].waitingTime = 
                            processes[shortestIndex].turnaroundTime - processes[shortestIndex].burstTime;
                    }
                }
                
                // Update the last Gantt chart end time
                if (ganttChartData.length > 0) {
                    ganttChartData[ganttChartData.length - 1].endTime = currentTime;
                }
                
                // Update process data with calculated values including response time
                for (let i = 0; i < processData.length; i++) {
                    const matchingProcess = processes.find(p => p.pid === processData[i].pid);
                    processData[i].completionTime = matchingProcess.completionTime;
                    processData[i].turnaroundTime = matchingProcess.turnaroundTime;
                    processData[i].waitingTime = matchingProcess.waitingTime;
                    processData[i].responseTime = matchingProcess.responseTime;
                }
            }
            
            // Improved Gantt chart rendering with animations
            function renderGanttChart() {
                // Calculate total execution time to determine if we need scaling
                const totalExecutionTime = ganttChartData.length > 0 ? 
                    ganttChartData[ganttChartData.length - 1].endTime - ganttChartData[0].startTime : 0;
                
                // Determine scaling factor based on total execution time
                // Reduce the scale factor as the timeline gets longer
                let scaleFactor = 30; // default scale factor
                if (totalExecutionTime > 50) {
                    scaleFactor = 15;
                } else if (totalExecutionTime > 30) {
                    scaleFactor = 20;
                } else if (totalExecutionTime > 20) {
                    scaleFactor = 25;
                }
                
                let html = `
                    <div class="gantt-container">
                        <h3 class="text-lg font-semibold mb-4 text-center text-gray-800">Process Execution Timeline</h3>
                        <div class="overflow-x-auto" style="max-width: 100%;">
                            <div class="gantt-chart relative" style="min-width: max-content; padding: 0 20px;">
                `;

                ganttChartData.forEach((item, index) => {
                    const width = (item.endTime - item.startTime) * scaleFactor; // dynamic scale factor
                    const processNumber = parseInt(item.pid.substring(1));

                    html += `
                        <div class="gantt-block-container" style="display: inline-block; text-align: center;">
                            <div class="process-block bg-process-${processNumber} animate-in" 
                                style="width: ${width}px; border: 2px solid #333; border-right: ${index === ganttChartData.length - 1 ? '2px' : '1px'} solid #333;">
                                ${item.pid}
                            </div>
                            <div class="time-label" style="width: ${width}px;">${formatNumber(item.startTime)}</div>
                        </div>
                    `;

                    // Add the final end time label only at the end
                    if (index === ganttChartData.length - 1) {
                        html += `
                            <div style="text-align: center;">
                                <div style="width: 0;"></div>
                                <div class="time-label">${formatNumber(item.endTime)}</div>
                            </div>
                        `;
                    }
                });

                html += `</div></div>`;
                
                html += `</div>`;
                return html;
            }
            
            // Show Gantt Chart
            function showGanttChart() {
                resultTitle.textContent = 'GANTT Chart';
                resultContent.innerHTML = renderGanttChart();
                resultsContainer.classList.remove('hidden');
                
                // Add animation to Gantt chart blocks
                setTimeout(() => {
                    const blocks = document.querySelectorAll('.process-block');
                    blocks.forEach((block, index) => {
                        setTimeout(() => {
                            block.classList.add('animate-complete');
                        }, index * 100);
                    });
                }, 100);
            }
            
            // Show Process Waiting Time
            function showWaitingTime() {
                resultTitle.textContent = 'Process Waiting Time';
                
                let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr class="bg-blue-50">
                                <th class="border-b p-3 text-blue-800">Process ID</th>
                                <th class="border-b p-3 text-blue-800">Waiting Time (msec)</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                processData.forEach((process, index) => {
                    html += `
                        <tr class="table-row-alt hover:bg-gray-50 transition-colors animate-row" style="animation-delay: ${index * 100}ms">
                            <td class="border-b p-3">${process.pid}</td>
                            <td class="border-b p-3">${formatNumber(process.waitingTime)}</td>
                        </tr>
                    `;
                });
                
                html += `</tbody></table></div>
                <div class="mt-4 solution-container">
                    <button id="waiting-time-solution-btn" class="solution-btn">Show Solution Steps</button>
                    <div id="waiting-time-solution" class="mt-4 hidden"></div>
                </div>`;
                
                resultContent.innerHTML = html;
                
                // Add event listener for solution button
                document.getElementById('waiting-time-solution-btn').addEventListener('click', function() {
                    const solutionDiv = document.getElementById('waiting-time-solution');
                    solutionDiv.classList.toggle('hidden');
                    
                    if (!solutionDiv.classList.contains('hidden')) {
                        let solutionHtml = `<h4 class="font-semibold text-gray-800 mb-2">Solution Steps:</h4>
                        <p class="mb-3">Waiting Time = Turnaround Time - Burst Time</p>`;
                        
                        processData.forEach((process, index) => {
                            solutionHtml += `
                            <div class="mb-3 p-3 bg-blue-50 rounded solution-step" style="animation-delay: ${index * 150}ms">
                                <p><strong>${process.pid}:</strong></p>
                                <p class="formula">Waiting Time = Turnaround Time - Burst Time</p>
                                <p class="formula">Waiting Time = ${formatNumber(process.turnaroundTime)} - ${formatNumber(process.burstTime)}</p>
                                <p class="formula">Waiting Time = ${formatNumber(process.waitingTime)}</p>
                            </div>`;
                        });
                        
                        solutionDiv.innerHTML = solutionHtml;
                        this.textContent = "Hide Solution Steps";
                        
                        // Animate solution steps
                        setTimeout(() => {
                            const steps = document.querySelectorAll('.solution-step');
                            steps.forEach(step => step.classList.add('animate-solution'));
                        }, 100);
                    } else {
                        this.textContent = "Show Solution Steps";
                    }
                });
                
                resultsContainer.classList.remove('hidden');
            }
            
            // Show Average Waiting Time
            function showAvgWaitingTime() {
                resultTitle.textContent = 'Average Waiting Time';
                
                // Calculate average waiting time
                const totalWaitingTime = processData.reduce((sum, process) => sum + process.waitingTime, 0);
                const avgWaitingTime = totalWaitingTime / processData.length;
                
                let html = `
                <div class="p-4 bg-blue-50 rounded-lg shadow-sm mb-4 result-card">
                    <h3 class="font-semibold text-blue-800 mb-2">Average Waiting Time: <span class="counter">${avgWaitingTime.toFixed(2)}</span> msec</h3>
                </div>
                <div class="solution-container mt-4">
                    <button id="avg-waiting-solution-btn" class="solution-btn">Show Solution Steps</button>
                    <div id="avg-waiting-solution" class="mt-4 hidden"></div>
                </div>`;
                
                resultContent.innerHTML = html;
                
                // Animate the counter
                animateCounter();
                
                // Add event listener for solution button
                document.getElementById('avg-waiting-solution-btn').addEventListener('click', function() {
                    const solutionDiv = document.getElementById('avg-waiting-solution');
                    solutionDiv.classList.toggle('hidden');
                    
                    if (!solutionDiv.classList.contains('hidden')) {
                        let solutionHtml = `<h4 class="font-semibold text-gray-800 mb-2">Solution Steps:</h4>
                        <p class="mb-3">Average Waiting Time = Sum of all process waiting times / Number of processes</p>
                        <div class="formula mb-3 animate-solution">
                            Average Waiting Time = (${processData.map(p => formatNumber(p.waitingTime)).join(' + ')}) / ${processData.length}
                        </div>
                        <div class="formula mb-3 animate-solution" style="animation-delay: 200ms">
                            Average Waiting Time = ${formatNumber(totalWaitingTime)} / ${processData.length}
                        </div>
                        <div class="formula mb-3 animate-solution" style="animation-delay: 400ms">
                            Average Waiting Time = ${avgWaitingTime.toFixed(2)}
                        </div>`;
                        
                        solutionDiv.innerHTML = solutionHtml;
                        this.textContent = "Hide Solution Steps";
                    } else {
                        this.textContent = "Show Solution Steps";
                    }
                });
                
                resultsContainer.classList.remove('hidden');
            }
            
            // Show Process Completion Time
            function showCompletionTime() {
                resultTitle.textContent = 'Process Completion Time';
                
                // First add the Gantt Chart for reference
                let html = renderGanttChart();
                
                // Then add the completion time table
                html += `
                <div class="table-container mt-8">
                    <table>
                        <thead>
                            <tr class="bg-green-50">
                                <th class="border-b p-3 text-green-800">Process ID</th>
                                <th class="border-b p-3 text-green-800">Completion Time (msec)</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                processData.forEach((process, index) => {
                    html += `
                        <tr class="table-row-alt hover:bg-gray-50 transition-colors animate-row" style="animation-delay: ${index * 100}ms">
                            <td class="border-b p-3">${process.pid}</td>
                            <td class="border-b p-3">${formatNumber(process.completionTime)}</td>
                        </tr>
                    `;
                });
                
                html += `</tbody></table></div>`;
                
                resultContent.innerHTML = html;
                resultsContainer.classList.remove('hidden');
                
                // Add animation to Gantt chart blocks
                setTimeout(() => {
                    const blocks = document.querySelectorAll('.process-block');
                    blocks.forEach((block, index) => {
                        setTimeout(() => {
                            block.classList.add('animate-complete');
                        }, index * 100);
                    });
                }, 100);
            }
            
            // Show Average Completion Time
            function showAvgCompletionTime() {
                resultTitle.textContent = 'Average Completion Time';
                
                // Calculate average completion time
                const totalCompletionTime = processData.reduce((sum, process) => sum + process.completionTime, 0);
                const avgCompletionTime = totalCompletionTime / processData.length;
                
                let html = `
                <div class="p-4 bg-green-50 rounded-lg shadow-sm mb-4 result-card">
                    <h3 class="font-semibold text-green-800 mb-2">Average Completion Time: <span class="counter">${avgCompletionTime.toFixed(2)}</span> msec</h3>
                </div>
                <div class="solution-container mt-4">
                    <button id="avg-completion-solution-btn" class="solution-btn">Show Solution Steps</button>
                    <div id="avg-completion-solution" class="mt-4 hidden"></div>
                </div>`;
                
                resultContent.innerHTML = html;
                
                // Animate the counter
                animateCounter();
                
                // Add event listener for solution button
                document.getElementById('avg-completion-solution-btn').addEventListener('click', function() {
                    const solutionDiv = document.getElementById('avg-completion-solution');
                    solutionDiv.classList.toggle('hidden');
                    
                    if (!solutionDiv.classList.contains('hidden')) {
                        let solutionHtml = `<h4 class="font-semibold text-gray-800 mb-2">Solution Steps:</h4>
                        <p class="mb-3">Average Completion Time = Sum of all process completion times / Number of processes</p>
                        <div class="formula mb-3 animate-solution">
                            Average Completion Time = (${processData.map(p => formatNumber(p.completionTime)).join(' + ')}) / ${processData.length}
                        </div>
                        <div class="formula mb-3 animate-solution" style="animation-delay: 200ms">
                            Average Completion Time = ${formatNumber(totalCompletionTime)} / ${processData.length}
                        </div>
                        <div class="formula mb-3 animate-solution" style="animation-delay: 400ms">
                            Average Completion Time = ${avgCompletionTime.toFixed(2)}
                        </div>`;
                        
                        solutionDiv.innerHTML = solutionHtml;
                        this.textContent = "Hide Solution Steps";
                    } else {
                        this.textContent = "Show Solution Steps";
                    }
                });
                
                resultsContainer.classList.remove('hidden');
            }
            
            // Show Process Turnaround Time
            function showTurnaroundTime() {
                resultTitle.textContent = 'Process Turnaround Time';
                
                let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr class="bg-yellow-50">
                                <th class="border-b p-3 text-yellow-800">Process ID</th>
                                <th class="border-b p-3 text-yellow-800">Turnaround Time (msec)</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                processData.forEach((process, index) => {
                    html += `
                        <tr class="table-row-alt hover:bg-gray-50 transition-colors animate-row" style="animation-delay: ${index * 100}ms">
                            <td class="border-b p-3">${process.pid}</td>
                            <td class="border-b p-3">${formatNumber(process.turnaroundTime)}</td>
                        </tr>
                    `;
                });
                
                html += `</tbody></table></div>
                <div class="mt-4 solution-container">
                    <button id="turnaround-solution-btn" class="solution-btn">Show Solution Steps</button>
                    <div id="turnaround-solution" class="mt-4 hidden"></div>
                </div>`;
                
                resultContent.innerHTML = html;
                
                // Add event listener for solution button
                document.getElementById('turnaround-solution-btn').addEventListener('click', function() {
                    const solutionDiv = document.getElementById('turnaround-solution');
                    solutionDiv.classList.toggle('hidden');
                    
                    if (!solutionDiv.classList.contains('hidden')) {
                        let solutionHtml = `<h4 class="font-semibold text-gray-800 mb-2">Solution Steps:</h4>
                        <p class="mb-3">Turnaround Time = Completion Time - Arrival Time</p>`;
                        
                        processData.forEach((process, index) => {
                            solutionHtml += `
                            <div class="mb-3 p-3 bg-yellow-50 rounded solution-step" style="animation-delay: ${index * 150}ms">
                                <p><strong>${process.pid}:</strong></p>
                                <p class="formula">Turnaround Time = Completion Time - Arrival Time</p>
                                <p class="formula">Turnaround Time = ${formatNumber(process.completionTime)} - ${formatNumber(process.arrivalTime)}</p>
                                <p class="formula">Turnaround Time = ${formatNumber(process.turnaroundTime)}</p>
                            </div>`;
                        });
                        
                        solutionDiv.innerHTML = solutionHtml;
                        this.textContent = "Hide Solution Steps";
                        
                        // Animate solution steps
                        setTimeout(() => {
                            const steps = document.querySelectorAll('.solution-step');
                            steps.forEach(step => step.classList.add('animate-solution'));
                        }, 100);
                    } else {
                        this.textContent = "Show Solution Steps";
                    }
                });
                
                resultsContainer.classList.remove('hidden');
            }
            
            // Show Average Turnaround Time
            function showAvgTurnaroundTime() {
                resultTitle.textContent = 'Average Turnaround Time';
                
                // Calculate average turnaround time
                const totalTurnaroundTime = processData.reduce((sum, process) => sum + process.turnaroundTime, 0);
                const avgTurnaroundTime = totalTurnaroundTime / processData.length;
                
                let html = `
                <div class="p-4 bg-yellow-50 rounded-lg shadow-sm mb-4 result-card">
                    <h3 class="font-semibold text-yellow-800 mb-2">Average Turnaround Time: <span class="counter">${avgTurnaroundTime.toFixed(2)}</span> msec</h3>
                </div>
                <div class="solution-container mt-4">
                    <button id="avg-turnaround-solution-btn" class="solution-btn">Show Solution Steps</button>
                    <div id="avg-turnaround-solution" class="mt-4 hidden"></div>
                </div>`;
                
                resultContent.innerHTML = html;
                
                // Animate the counter
                animateCounter();
                
                // Add event listener for solution button
                document.getElementById('avg-turnaround-solution-btn').addEventListener('click', function() {
                    const solutionDiv = document.getElementById('avg-turnaround-solution');
                    solutionDiv.classList.toggle('hidden');
                    
                    if (!solutionDiv.classList.contains('hidden')) {
                        let solutionHtml = `<h4 class="font-semibold text-gray-800 mb-2">Solution Steps:</h4>
                        <p class="mb-3">Average Turnaround Time = Sum of all process turnaround times / Number of processes</p>
                        <div class="formula mb-3 animate-solution">
                            Average Turnaround Time = (${processData.map(p => formatNumber(p.turnaroundTime)).join(' + ')}) / ${processData.length}
                        </div>
                        <div class="formula mb-3 animate-solution" style="animation-delay: 200ms">
                            Average Turnaround Time = ${formatNumber(totalTurnaroundTime)} / ${processData.length}
                        </div>
                        <div class="formula mb-3 animate-solution" style="animation-delay: 400ms">
                            Average Turnaround Time = ${avgTurnaroundTime.toFixed(2)}
                        </div>`;
                        
                        solutionDiv.innerHTML = solutionHtml;
                        this.textContent = "Hide Solution Steps";
                    } else {
                        this.textContent = "Show Solution Steps";
                    }
                });
                
                resultsContainer.classList.remove('hidden');
            }
            
            // Helper functions for UI enhancements
            
            // Notification system
            function showNotification(message, type) {
                // Remove any existing notifications
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) {
                    existingNotification.remove();
                }
                
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <div class="notification-content">
                        <span>${message}</span>
                        <button class="notification-close">&times;</button>
                    </div>
                `;
                
                // Add to DOM
                document.body.appendChild(notification);
                
                // Show with animation
                setTimeout(() => {
                    notification.classList.add('show');
                }, 10);
                
                // Add close button event
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                });
                
                // Auto hide after 3 seconds
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }
                }, 3000);
            }
            
            // Animate input when value changes
            function animateInput(input) {
                input.classList.add('input-highlight');
                setTimeout(() => input.classList.remove('input-highlight'), 1000);
            }
            
            // Animate metrics buttons
            function animateMetricsButtons() {
                const buttons = document.querySelectorAll('.action-btn');
                buttons.forEach((button, index) => {
                    button.style.opacity = '0';
                    button.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        button.style.transition = 'all 0.4s ease';
                        button.style.opacity = '1';
                        button.style.transform = 'translateY(0)';
                    }, index * 100);
                });
            }
            
            // Animate counter
            function animateCounter() {
                const counters = document.querySelectorAll('.counter');
                
                counters.forEach(counter => {
                    const target = parseFloat(counter.textContent);
                    let count = 0;
                    const duration = 1500; // ms
                    const increment = target / (duration / 30); // Update every 30ms
                    
                    counter.textContent = '0.00';
                    
                    const timer = setInterval(() => {
                        count += increment;
                        if (count >= target) {
                            counter.textContent = target.toFixed(2);
                            clearInterval(timer);
                        } else {
                            counter.textContent = count.toFixed(2);
                        }
                    }, 30);
                });
            }
            
            // Add a new helper function for number formatting after the animateCounter function
            function formatNumber(num) {
                // Check if the number is a whole number
                return Number.isInteger(num) ? num.toString() : num.toFixed(1);
            }
            
            // Initialize with 5 processes
            generateProcessTable(5);
        });
    </script>
</body>
</html>